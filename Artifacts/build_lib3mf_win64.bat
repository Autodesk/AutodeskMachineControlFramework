@echo off

set basepath=%~dp0
echo %basepath%
cd %basepath%

mkdir ..\build_lib3mf_win64
cd ..\build_lib3mf_win64

del ..\..\Artifacts\lib3mf\lib3mf_win64.dll
del ..\..\Artifacts\lib3mf\lib3mf_dynamic.h
del ..\..\Artifacts\lib3mf\lib3mf_dynamic.hpp
del ..\..\Artifacts\lib3mf\lib3mf_types.hpp
del ..\..\Artifacts\lib3mf\_githash_lib3mf.txt

cmake ..\submodules\lib3mf
cmake --build . --config Release
copy Release\lib3mf.dll ..\..\Libraries\lib3mf\lib3mf_win64.dll /Y

cd ..
cd lib3mf

copy Autogenerated\Bindings\CppDynamic\lib3mf_dynamic.h ..\..\Libraries\lib3mf\
copy Autogenerated\Bindings\CppDynamic\lib3mf_dynamic.hpp ..\..\Libraries\lib3mf\
copy Autogenerated\Bindings\CppDynamic\lib3mf_types.hpp ..\..\Libraries\lib3mf\

git rev-parse --verify HEAD >"..\..\Libraries\lib3mf\_githash_lib3mf.txt"

cd ..

pause